!function(){const t=/https:\/\/www\.youtube\.com/i,i=/https:\/\/www\.youtube\.com\/live_chat\?continuation=/i,r=visualSettingsKey,l=new Emotes,a=new Set;let o=!1,u=!1,s=!1,d=!0,c=void 0,y=void 0,h={...defaultVisualSettings},v=void 0,m=!1,g={...defaultChatElements},p=[],b=0,w=[],f=[],n="",E=!1;const S=()=>Utils.canRun(i,document.location.href);const x=()=>{if(!(()=>{if(!Utils.exists(window.parent)||!Utils.exists(window.parent.window))return!1;const e=window.parent.window;var t=document.querySelector("yt-live-chat-app"),i=e.document.querySelector("ytd-live-chat-frame");return Utils.exists(t)||Utils.exists(i)})())return"";var e=document.querySelector("ytd-channel-name > #container > #text-container > yt-formatted-string > a");return Utils.exists(e)?e.innerText:""},U=()=>{const t=x().toLowerCase();var e=supportedChannels.find(e=>e.youtube.name===t);return Utils.exists(e)&&!e.youtube.enable},A=(s=null,e=!1)=>{if(!Utils.exists(s)||!u)return s;e&&s.setAttribute("ytg-hidden","");var t=s.tagName,i=s.hasAttribute("is-deleted");const n=s.querySelector("#content");e="YT-LIVE-CHAT-MEMBERSHIP-ITEM-RENDERER"===t||"YT-LIVE-CHAT-PAID-MESSAGE-RENDERER"===t||"YT-LIVE-CHAT-VIEWER-ENGAGEMENT-MESSAGE-RENDERER"===t||"YTD-SPONSORSHIPS-LIVE-CHAT-GIFT-REDEMPTION-ANNOUNCEMENT-RENDERER"===t||s.hasAttribute("show-only-header");if("YT-LIVE-CHAT-TEXT-MESSAGE-RENDERER"!==t&&!e||s.hasAttribute("ytg-checked"))return s.removeAttribute("ytg-hidden"),s.setAttribute("ytg-checked",""),s;if(h.chat.separatedLines&&(E&&s.setAttribute("ytg-chat-alt",""),E=!E),h.chat.showDeleted&&!e){i&&(s.removeAttribute("is-deleted"),s.setAttribute("ytg-deleted",""));const r=new MutationObserver(e=>{for(const i of e)if("attributes"===i.type){const n=i.target;var t;Utils.exists(n)&&n.hasAttribute("is-deleted")&&(u&&(s.removeAttribute("is-deleted"),s.setAttribute("ytg-deleted","")),r&&(-1<(t=w.indexOf(r))&&w.splice(t,1),r.disconnect()))}});r.observe(s,{attributes:!0}),w.push(r);const o=setTimeout(()=>{var e;void 0!==r&&(-1<(e=w.indexOf(r))&&w.splice(e,1),r.disconnect()),void 0!==o&&(-1<(e=f.indexOf(o))&&f.splice(e,1),clearTimeout(o))},6e4);f.push(o)}if(Utils.exists(n)){const a=n.querySelector("yt-live-chat-author-chip > #author-name");t=n.querySelector("#message"),i=Math.round((new Date).getTime()/1e3);if(h.chat.nameColor&&Utils.exists(a)&&!e){const d=a.innerText.trim().toLowerCase(),c=p.find(e=>e.name===d);let e=Utils.generatePastelColor();null==c?p.push({color:e,name:d,ts:i}):(e=c.color,c.ts=i),a.style.setProperty("color",e,"important")}(h.chat.bttvEmotes||h.chat.ffzEmotes)&&l.insertTo(t)}return s.setAttribute("ytg-checked",""),s},L=(e=950)=>{clearTimeout(v);var t=100*a.size,t=Utils.randomInt(t<750?750:t,2e3),t=t<2e3?t:2e3;if(Utils.exists(g.target)&&s&&0<a.size){m=!0;const n=new Set([...a]);a.clear(),m=!1;var i=Math.round(t/(0<n.size?n.size:1)-100);for(let e of n.values()){if(!u)break;Utils.exists(e)&&(isFinite(i)&&n.size<3?setTimeout(()=>{u&&e.removeAttribute("ytg-hidden")},i):e.removeAttribute("ytg-hidden"))}}T(e)},T=(e=950)=>{clearTimeout(v),h.chat.simulatedDelay&&(v=setTimeout(()=>L(e),e))},M=(e=!0,t=!1)=>{clearInterval(c),clearTimeout(v),a.clear(),void 0!==O&&O.disconnect(),void 0!==C&&C.disconnect(),N&&N.disconnect(),void 0!==B&&B.disconnect(),void 0!==I&&I.disconnect(),l.emojiPickerObserver&&l.emojiPickerObserver.disconnect(),0<w.length&&(w.every(e=>!!u&&(void 0===e&&e.disconnect(),!0)),w.length=0),0<f.length&&(f.every(e=>!!u&&(void 0===e&&clearTimeout(e),!0)),f.length=0),e&&q(t)},R=new MutationObserver(e=>{for(const i of e){var t;"attributes"===i.type&&("is-two-columns_"==i.attributeName?(t=i.target,Utils.exists(t)&&u&&M(!0)):"style"==i.attributeName&&resetVideoSize())}}),O=new MutationObserver((e,t)=>{for(const i of e.filter(e=>"items"===e.target.id).filter(e=>0<e.addedNodes.length))if(void 0!==i&&0!==i.addedNodes.length)for(const n of i.addedNodes)Utils.exists(n)&&u&&(h.chat.simulatedDelay&&!m?(a.add(A(n,!0)),15<=a.size&&L()):A(n))}),C=new MutationObserver((e,t)=>{M(!0)}),I=new MutationObserver(e=>{for(const i of e){var t;"attributes"===i.type&&(t=i.target,Utils.exists(t)&&u&&M(!0))}}),N=new MutationObserver(e=>{for(const i of e){var t;"attributes"===i.type&&(t=i.target,Utils.exists(t)&&u&&M(!0))}}),B=new MutationObserver(e=>{var e=e.find(e=>Utils.exists(e));Utils.exists(e)&&(e=e.target,Utils.exists(e)&&Utils.exists(g.innerBody)&&u&&l.injectSuggestions(g,e.textContent))}),q=(o=!1)=>{clearInterval(c),clearTimeout(v),c=setInterval(()=>{if(u&&(g.app=document.querySelector("yt-live-chat-app"),Utils.exists(g.app))){if(window.parent.window.addEventListener("updateChatCollapsed",e=>{e=e.detail.collapsed;D(e)}),window.addEventListener("updateChatCollapsed",e=>{e=e.detail.collapsed;D(e)}),g.innerBody=g.app.closest("body"),o&&h.showReplayChat&&g.app.hasAttribute("collapsed")){const i=g.app.querySelector("#show-hide-button > ytd-toggle-button-renderer > a.yt-simple-endpoint");Utils.exists(i)&&i.click()}if(Utils.exists(g.innerBody)&&(g.target=g.innerBody.querySelector("#items.yt-live-chat-item-list-renderer"),Utils.exists(g.target))){window.addEventListener("yt-live-chat-item-list-renderer",e=>{}),window.addEventListener("handleAddChatItemAction_",e=>{}),g.target.addEventListener("handleAddChatItemAction_",e=>{}),window.addEventListener("yt-live-chat-text-input-field-renderer",e=>{}),window.addEventListener("calculateLiveChatRichMessageInput_",e=>{}),window.addEventListener("yt-live-chat-renderer",e=>{}),window.addEventListener("preprocessActions_",e=>{});const n=()=>{const t=document.querySelector("yt-live-chat-item-list-renderer");null!=t&&"emojiManager"in t&&(t.emojiManager._ytg||(t.emojiManager._ytg=!0,t.emojiManager.load([...e.values()])))};window.addEventListener("emotes",e=>{n()}),window.parent.window.addEventListener("emotes",e=>{n()});const s=g.innerBody.querySelector("yt-live-chat-participant-list-renderer");if(V(),clearInterval(c),clearTimeout(v),a.clear(),g.dropdown=g.innerBody.querySelector(".yt-live-chat-header-renderer > yt-dropdown-menu > tp-yt-paper-menu-button > tp-yt-iron-dropdown tp-yt-paper-listbox"),Utils.exists(g.dropdown)&&(d&&(g.modes=g.dropdown.querySelectorAll("a"),Utils.exists(g.modes)&&2<=g.modes.length&&(!0===g.modes[1].getAttribute("aria-selected")&&"true"===g.modes[1].getAttribute("aria-selected")||g.modes[1].click()),d=!1),C.observe(g.dropdown,{attributes:!0,characterData:!0,childList:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0})),Utils.exists(s)&&N.observe(s,{attributes:!0}),!Utils.exists(s)||s.hasAttribute("disable-upgrade")){const r=[...g.target.children];r.every(e=>!!u&&(Utils.exists(e)&&A(e),!0)),O.observe(g.target,{childList:!0,subtree:!0});var t=g.target.querySelector("#show-more.yt-live-chat-item-list-renderer");Utils.exists(t)?I.observe(t,{attributes:!0}):void 0!==I&&I.disconnect(),h.chat.simulatedDelay&&T(),void 0===y&&(y=setInterval(()=>{const t=p.length;let i=[...p];b!==t&&Storage.getLocalBytesInUse(chatUsersKey).then(e=>{98<=(e/4e6*100).toFixed(2)&&(e=Math.round(.1*i.length),i.sort((e,t)=>e.ts-t.ts).splice(0,e),alert(`filtered out ${t-i.length} inactive chatUsers!`))}).catch(e=>{}).finally(()=>{const e=i.length;Storage.setLocal(chatUsersKey,i).then(()=>b=e).catch(e=>{})})},1e4)),g.textInputFieldRenderer=g.innerBody.querySelector("yt-live-chat-text-input-field-renderer"),g.inputRenderer=g.innerBody.querySelector("yt-live-chat-message-input-renderer yt-live-chat-text-input-field-renderer"),Utils.exists(g.inputRenderer)&&(g.inputField=g.inputRenderer.querySelector("#input"),Utils.exists(g.inputRenderer)&&(g.ironDropdown=g.inputRenderer.querySelector("tp-yt-iron-dropdown"),Utils.exists(g.ironDropdown)&&(g.dropdownContent=g.ironDropdown.querySelector(".dropdown-content.yt-live-chat-text-input-field-renderer"))),Utils.exists(g.inputField)?B.observe(g.inputField,{characterData:!0,subtree:!0}):void 0!==B&&B.disconnect())}(h.chat.bttvEmotes||h.chat.ffzEmotes)&&(t=g.innerBody.querySelector("yt-emoji-picker-renderer.yt-live-chat-message-input-renderer"),Utils.exists(t)&&l.emojiPickerObserver.observe(t,{attributes:!0}))}}},500)},D=e=>{Utils.exists(document.body)&&(e?document.body.hasAttribute("ytg-hide-chat")||document.body.setAttribute("ytg-hide-chat",""):document.body.hasAttribute("ytg-hide-chat")&&document.body.removeAttribute("ytg-hide-chat"))},j=()=>{0===p.length?Storage.getLocal(chatUsersKey,p).then(e=>{const t=[...e],i=0<t.length?new Set(t.map(e=>e.name)):new Set;p=[...t,...p.filter(e=>!i.has(e.name))],b=p.length}).catch(e=>{}).finally(()=>M(!0,!0)):M(!0,!0)},k=()=>{u&&(s="visible"===document.visibilityState)},V=()=>{Utils.exists(g.innerBody)&&(g.innerBody.hasAttribute("ytg-plus")||g.innerBody.setAttribute("ytg-plus",""),h.chat.icon||g.innerBody.hasAttribute("ytg-no-avatar")||g.innerBody.setAttribute("ytg-no-avatar",""))},z=()=>{g.app=document.querySelector("yt-live-chat-app"),Utils.exists(g.app)&&(Utils.exists(g.innerBody)||(g.innerBody=g.app.closest("body")),Utils.exists(g.innerBody)&&(g.innerBody.hasAttribute("ytg-plus")&&g.innerBody.removeAttribute("ytg-plus"),g.innerBody.hasAttribute("ytg-no-avatar")&&g.innerBody.removeAttribute("ytg-no-avatar")))},P=()=>{void 0!==Y&&Y.disconnect(),Utils.exists(document.body)&&!document.body.hasAttribute("ytg-plus")&&document.body.setAttribute("ytg-plus","")},F=()=>{z(),void 0!==Y&&Y.disconnect(),Utils.exists(document.body)&&document.body.hasAttribute("ytg-plus")&&document.body.removeAttribute("ytg-plus")},H=()=>{const e=document.head||document.documentElement;Utils.exists(e)&&(Utils.exists(e.querySelector("link#ytg-plus-chat"))||e.insertAdjacentHTML("beforeend",'<link rel="stylesheet" type="text/css"  id="ytg-plus-chat" href="'+chrome.runtime.getURL("styles/ytg-plus-chat.min.css")+'" />'))},_=()=>{chrome.runtime.sendMessage({type:"youtubegaming+",system:"general",action:"executeScript",files:["src/chat/emotesInjected.min.js"]},e=>{})},G=()=>{d=!0,g={target:document.createElement("div"),innerBody:void 0,dropdown:void 0,modes:void 0,inputRenderer:void 0,inputField:void 0,ironDropdown:void 0,dropdownContent:void 0},l.chatSettings=h.chat,l.load(n,g),document.addEventListener("visibilitychange",k);var e=document.querySelector("ytd-page-manager > ytd-watch-flexy");Utils.exists(e)&&R.observe(e,{attributes:!0}),window.addEventListener("yt-live-chat-select-suggestion",e=>{}),h.theatreMode&&P(),h.chat.icon||Utils.exists(document.body)&&!document.body.hasAttribute("ytg-no-avatar")&&document.body.setAttribute("ytg-no-avatar",""),M(!0),j(),window.dispatchEvent(new Event("resize")),U()?(u=!1,K(),W(),F()):_()},J=()=>{if(u){if(o)G();else{if(U())return u=!1,K(),W(),F(),!1;Storage.getSync(r,JSON.stringify(h)).then(e=>{o=!0,h={...h,...e},l.chatSettings=h.chat}).catch(e=>{}).finally(()=>{window.addEventListener("chat.emotes.getSettings",()=>{window.dispatchEvent(new CustomEvent("chat.emotes.settings",{detail:{chat:h.chat},bubbles:!0}))}),window.addEventListener("chat.emotes.emojiManager",e=>{}),window.dispatchEvent(new Event("chat.emotes.getEmojiManager")),G()})}return void 0!==Y&&Y.disconnect(),!0}return!1},Y=new MutationObserver(e=>{e.some(()=>{if(S())return Y.disconnect(),J()})}),K=()=>{void 0!==Y&&Y.disconnect(),void 0!==R&&R.disconnect(),M(!1)},W=()=>{clearInterval(c),clearInterval(y),clearTimeout(v),a.clear()},X=()=>{Utils.canRun(t,document.location.href)&&(u=!1,a.clear(),W(),K(),H(),setTimeout(()=>{(()=>{if(!S())return u=!1,K(),W();u=!0,s="visible"===document.visibilityState,H(),J()||Y.observe(document.documentElement,{attributes:!0,characterData:!0,childList:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0})})()},500))};window.onload=X,window.addEventListener("yt-navigate-start",X,!0),chrome.runtime.onMessage.addListener((e,t,i)=>{if(S()&&e.type&&"youtubegaming+"===e.type&&e.system)if("background"===e.system)e.action&&"urlChange"===e.action?(F(),X()):e.action&&"initialLoad"===e.action?(o=!1,e.data.visualSettings&&(h={...h,...JSON.parse(JSON.stringify(e.data.visualSettings))},l.chatSettings=h.chat),F(),X()):e.action&&"extensionUpdate"===e.action||e.action&&e.action;else if("settings"===e.system){if(e.action&&"getSync"===e.action){const n=JSON.stringify(e.data)??JSON.stringify({});return Storage.getSync(e.key??"",n).then(e=>(i({success:!0,data:e}),!0)).catch(e=>(i({success:!1,data:n}),!0))}if(e.action&&"setSync"===e.action){const s=e.data??JSON.stringify({});return Storage.setSync(e.key??"",s).then(()=>(i({success:!0,data:s}),!0)).catch(e=>(i({success:!1,data:s}),!0))}}}),chrome.storage.onChanged.addListener((e,t)=>{for(var[i,{oldValue:n,newValue:s}]of Object.entries(e))if(i===r){if(o=!1,!S())return;h={...h,...s},l.chatSettings=h.chat,F(),X()}})}();