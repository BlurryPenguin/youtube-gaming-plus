"use strict";(function(){function t(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:148,g:187,b:34}}function e(t,e){chrome.storage.sync.set(t,function(){e(t)})}function i(t,i,a,n){var g={};void 0!==n&&n===!0?g[t]=JSON.stringify(i):g[t]=i,e(g,function(t){a(null===t?!1:!0)})}function a(t,e){chrome.storage.sync.get(t,e)}function n(t,e,i){a(t,function(a){i(null===a?e:void 0!==a[t]&&null!==a[t]?a[t]:e)})}function g(){void 0===N.generalSettings?s(B.general.theme,I):N.generalSettings.darkTheme?s(B.general.Theme,I):s(B.general.Theme,v),void 0===N.chatSettings?(s(B.chat.Highlight.tab,I),s(B.chat.Highlight.back,I),s(B.chat.Highlight.text,I),s(B.chat.Notify.chk,I),s(B.chat.HideImages,I),B.chat.Highlight.additional.value=""):(N.chatSettings.Highlight.tab?s(B.chat.Highlight.tab,I):s(B.chat.Highlight.tab,v),N.chatSettings.Highlight.back?s(B.chat.Highlight.back,I):s(B.chat.Highlight.back,v),N.chatSettings.Highlight.text?s(B.chat.Highlight.text,I):s(B.chat.Highlight.text,v),N.chatSettings.Notify?s(B.chat.Notify.chk,I):s(B.chat.Notify.chk,v),void 0!==N.chatSettings.Highlight.additional?B.chat.Highlight.additional.value=N.chatSettings.Highlight.additional:B.chat.Highlight.additional.value=f.Highlight.additional,N.chatSettings.HideImages?s(B.chat.HideImages,I):s(B.chat.HideImages,v)),l(),p&&(p=!1,B.general.Loading.style.display="none",B.general.Loaded.style.display="block")}function l(){var e="208efc";if(void 0!==N.generalSettings&&(e=N.generalSettings.nameColor),void 0!==B.chat.Highlight.example){if(o(B.chat.Highlight.tab)?(B.chat.Highlight.example.className="chat-text",B.chat.Highlight.example.style.borderLeft="medium solid #"+e,B.chat.Highlight.example.style.borderColor="#"+e):(B.chat.Highlight.example.style.borderLeft="",B.chat.Highlight.example.style.borderColor=""),o(B.chat.Highlight.back)){var i=t("#"+e);B.chat.Highlight.example.className="chat-text",B.chat.Highlight.example.style.background="rgba("+i.r+","+i.g+","+i.b+",0.1)",B.chat.Highlight.example.style.borderColor="rgba("+i.r+","+i.g+","+i.b+",0.1)"}else B.chat.Highlight.example.style.background="",N.chatSettings.Highlight.tab||(B.chat.Highlight.example.style.borderColor="");o(B.chat.Highlight.text)?(B.chat.Highlight.example.className="chat-text",B.chat.Highlight.example.style.color="#"+e,B.chat.Highlight.example.style.borderColor="#"+e):(B.chat.Highlight.example.style.color="",N.chatSettings.Highlight.tab||N.chatSettings.Highlight.back||(B.chat.Highlight.example.style.borderColor=""))}}function h(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),t=t.replace(/ /g,",");do t=t.replace(",,",",");while(t.indexOf(",,")>0);return i&&","===t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),e?t.replace(/[.-\/#!$%\^&\*;:{}=\-_`~()]/g,"").replace(/\s{2,}/g," "):t}function c(){B={general:{SaveBtn:document.getElementById("saveBtn"),SectionStatus:document.getElementById("sectionStatus"),Loading:document.getElementById("loading"),Loaded:document.getElementById("loaded"),Theme:document.getElementById("chkTheme")},chat:{Section:document.getElementById("sectionChat"),Highlight:{example:document.getElementById("spanExampleHighlight"),tab:document.getElementById("chkTabHighlight"),back:document.getElementById("chkBackHighlight"),text:document.getElementById("chkTextHighlight"),additional:document.getElementById("txtHighlightNames")},Notify:{li:document.getElementById("desktopNotification"),chk:document.getElementById("chkNotify")},HideImages:document.getElementById("chkHideImages")}}}function s(t,e){void 0===e&&(e=v),t.innerHTML=e.innerHTML,t.className=e.className}function o(t){return t.className===I.className}function d(){B.general.SaveBtn.style.display="block"}function m(){B.general.SaveBtn.style.display="none"}function r(){var t={generalSettings:S,chatSettings:f};t.generalSettings.userName=N.generalSettings.userName,t.generalSettings.nameColor=N.generalSettings.nameColor,t.generalSettings.darkTheme=o(B.general.Theme),t.chatSettings.Highlight.tab=o(B.chat.Highlight.tab),t.chatSettings.Highlight.back=o(B.chat.Highlight.back),t.chatSettings.Highlight.text=o(B.chat.Highlight.text),t.chatSettings.Notify=o(B.chat.Notify.chk),t.chatSettings.HideImages=o(B.chat.HideImages),N.chatSettings&&N.chatSettings.Highlight&&(void 0!==N.chatSettings.Highlight.additional?t.chatSettings.Highlight.additional=h(B.chat.Highlight.additional.value,!0,!0):t.chatSettings.Highlight.additional=f.Highlight.additional),i(k,t.generalSettings,function(e){var a=null;e?i(b,t.chatSettings,function(e){a=null,e?(N=t,x=N,B.chat.Highlight.additional.value=N.chatSettings.Highlight.additional,a=document.getElementById("status"),a.textContent="Settings saved.",B.general.SectionStatus.style.display="block",setTimeout(function(){a.textContent="",B.general.SectionStatus.style.display="none"},1500),m()):(a=document.getElementById("status"),a.textContent="Failed to save!",B.general.SectionStatus.style.display="block",setTimeout(function(){a.textContent="",B.general.SectionStatus.style.display="none"},1500))}):(a=document.getElementById("status"),a.textContent="Failed to save!",B.general.SectionStatus.style.display="block",setTimeout(function(){a.textContent="",B.general.SectionStatus.style.display="none"},1500))})}function u(){n(k,S,function(t){var e=S;null!==t&&(void 0!==t.userName&&null!==t.userName&&(e.userName=t.userName),void 0!==t.nameColor&&null!==t.nameColor&&(e.nameColor=t.nameColor),void 0!==t.darkTheme&&null!==t.darkTheme&&(e.darkTheme=t.darkTheme)),N.generalSettings=e,x.generalSettings=e,H(),"Notification"in window&&"denied"!==window.Notification.permission?B.chat.Notify.li.style.display="block":B.chat.Notify.li.style.display="none"})}function H(){n(b,f,function(t){var e=f;null!==t&&(void 0!==t.Highlight&&null!==t.Highlight&&(void 0!==t.Highlight.tab&&null!==t.Highlight.tab&&(e.Highlight.tab=t.Highlight.tab),void 0!==t.Highlight.back&&null!==t.Highlight.back&&(e.Highlight.back=t.Highlight.back),void 0!==t.Highlight.text&&null!==t.Highlight.text&&(e.Highlight.text=t.Highlight.text),void 0!==t.Highlight.additional&&null!==t.Highlight.additional&&(e.Highlight.additional=t.Highlight.additional)),void 0!==t.Notify&&null!==t.Notify&&(e.Notify=t.Notify),void 0!==t.HideImages&&null!==t.HideImages&&(e.HideImages=t.HideImages)),N.chatSettings=e,x.chatSettings=e,g()})}function y(){x.generalSettings&&(N.generalSettings=x.generalSettings),x.chatSettings&&(N.chatSettings=x.chatSettings),c(),g(),m()}var S={darkTheme:!1,userName:"",nameColor:"208efc"},f={Highlight:{tab:!1,back:!1,text:!1,additional:""},Notify:!1,HideImages:!1},k="smashcastPlus.generalSettings",b="smashcastPlus.chatSettings",v={className:"fltR toggle-switch-settings toggle-switch ng-isolate-scope ng-valid ng-dirty ng-valid-parse switch-off",innerHTML:'<span class="knob"><div></div></span><span class="switch-right ng-binding">Off</span>'},I={className:"fltR toggle-switch-settings toggle-switch ng-isolate-scope ng-valid ng-dirty ng-valid-parse switch-on",innerHTML:'<span class="switch-left ng-binding">On</span><span class="knob"><div></div></span>'},p=!0,N={},x={},E=null,B={general:{SaveBtn:document.getElementById("saveBtn"),SectionStatus:document.getElementById("sectionStatus"),Loading:document.getElementById("loading"),Loaded:document.getElementById("loaded"),Theme:document.getElementById("chkTheme")},chat:{Section:document.getElementById("sectionChat"),Highlight:{example:document.getElementById("spanExampleHighlight"),tab:document.getElementById("chkTabHighlight"),back:document.getElementById("chkBackHighlight"),text:document.getElementById("chkTextHighlight"),additional:document.getElementById("txtHighlightNames")},Notify:{li:document.getElementById("desktopNotification"),chk:document.getElementById("chkNotify")},HideImages:document.getElementById("chkHideImages")}};document.addEventListener("DOMContentLoaded",function(){p=!0,c(),u()}),document.getElementById("refreshBtn").addEventListener("click",y),document.getElementById("saveBtn").addEventListener("click",r),document.getElementById("chkTabHighlight").addEventListener("click",function(){N.chatSettings&&N.chatSettings.Highlight&&(B.chat.Highlight.tab.className===I.className?s(B.chat.Highlight.tab,v):s(B.chat.Highlight.tab,I),l(),d())},!1),document.getElementById("chkBackHighlight").addEventListener("click",function(){N.chatSettings&&N.chatSettings.Highlight&&(B.chat.Highlight.back.className===I.className?s(B.chat.Highlight.back,v):s(B.chat.Highlight.back,I),l(),d())},!1),document.getElementById("chkTextHighlight").addEventListener("click",function(){N.chatSettings&&N.chatSettings.Highlight&&(B.chat.Highlight.text.className===I.className?s(B.chat.Highlight.text,v):s(B.chat.Highlight.text,I),l(),d())},!1),document.getElementById("txtHighlightNames").addEventListener("input",function(t){N.chatSettings&&N.chatSettings.Highlight&&(E=setTimeout(function(){t.target.value=h(t.target.value,!0)},500)),d()},!1),document.getElementById("chkNotify").addEventListener("click",function(){N.chatSettings&&(B.chat.Notify.chk.className===I.className?s(B.chat.Notify.chk,v):s(B.chat.Notify.chk,I),d())},!1),document.getElementById("chkHideImages").addEventListener("click",function(){N.chatSettings&&(B.chat.HideImages.className===I.className?s(B.chat.HideImages,v):s(B.chat.HideImages,I),d())},!1),document.getElementById("chkTheme").addEventListener("click",function(){N.chatSettings&&(B.general.Theme.className===I.className?s(B.general.Theme,v):s(B.general.Theme,I),d())},!1)})();